<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ±Ù… Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø´ØªÙ‡ Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.rtl.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            font-family: Tahoma, Arial, sans-serif;
            background-color: #f7f7f7;
            padding: 20px;
            line-height: 1.6;
        }
        .print-header {
            display: none;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            .print-section, .print-section * {
                visibility: visible;
            }
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
            }
            .print-header {
                display: block;
                text-align: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 2px solid #000;
            }
            .print-header h1 {
                font-size: 24px;
                margin-bottom: 5px;
                color: #000;
            }
            .print-header h2 {
                font-size: 18px;
                margin-bottom: 5px;
                color: #000;
            }
            .print-header p {
                font-size: 14px;
                margin: 3px 0;
                color: #000;
            }
            .buttons {
                display: none !important;
            }
            .actions-column {
                display: none !important;
            }
            input, select {
                border: none !important;
                background: transparent !important;
                padding: 0 !important;
                height: auto !important;
                text-align: center;
            }
            .field-period {
                display: block;
                width: 100%;
                text-align: center;
            }
            /* Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† placeholderÙ‡Ø§ Ø¯Ø± Ù¾Ø±ÛŒÙ†Øª */
            ::-webkit-input-placeholder {
                color: transparent !important;
            }
            :-moz-placeholder {
                color: transparent !important;
            }
            ::-moz-placeholder {
                color: transparent !important;
            }
            :-ms-input-placeholder {
                color: transparent !important;
            }
            input:empty::before {
                content: none !important;
            }
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .header h1 {
            color: #3f51b5;
            margin-bottom: 5px;
            font-size: 24px;
            font-weight: bold;
        }
        .header h2 {
            color: #666;
            font-size: 16px;
            font-weight: normal;
        }
        .contact-info {
            background-color: #e3f2fd;
            padding: 8px;
            border-radius: 5px;
            margin: 8px 0;
            font-size: 13px;
        }
        .instructions {
            background-color: #e3f2fd;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 13px;
        }
        .instructions h4 {
            margin-bottom: 8px;
            color: #3f51b5;
        }
        .table-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        th, td {
            border: 1px solid #aaa;
            padding: 6px;
            text-align: center;
            height: 35px;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
            z-index: 10;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:nth-child(odd) {
            background-color: #fff;
        }
        tr:hover {
            background-color: #f0f7ff;
        }
        .dragging {
            background-color: #d1e7fd !important;
            opacity: 0.7;
        }
        .buttons {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        .btn {
            background-color: #007bff;
            border: none;
            color: white;
            padding: 6px 12px;
            font-size: 13px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .btn-info {
            background-color: #17a2b8;
        }
        .btn-info:hover {
            background-color: #138496;
        }
        .btn-secondary {
            background-color: #6c757d;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .btn-warning {
            background-color: #ffc107;
            color: #000;
        }
        .btn-warning:hover {
            background-color: #e0a800;
        }
        .row-number {
            width: 40px;
            text-align: center;
            font-weight: bold;
            background-color: #f0f0f0;
        }
        .ui-state-highlight {
            background-color: #ffffcc !important;
            height: 35px;
        }
        /* Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ­ØµÛŒÙ„ÛŒ */
        .doreh-Ø±ÙˆØ²Ø§Ù†Ù‡ {
            background-color: #000000 !important;
            color: white !important;
            font-weight: bold;
        }
        .doreh-Ù†ÙˆØ¨Øª-Ø¯ÙˆÙ… {
            background-color: #009900 !important;
            color: white !important;
            font-weight: bold;
        }
        .doreh-Ù¾Ø±Ø¯ÛŒØ³-Ø³Ø±Ø§Ø³Ø±ÛŒ {
            background-color: #cc0000 !important;
            color: white !important;
            font-weight: bold;
        }
        .doreh-Ø¢Ø²Ø§Ø¯ {
            background-color: #cc0000 !important;
            color: white !important;
            font-weight: bold;
        }
        .doreh-Ù¾ÛŒØ§Ù…-Ù†ÙˆØ± {
            background-color: #663300 !important;
            color: white !important;
            font-weight: bold;
        }
        .doreh-ØºÛŒØ±Ø§Ù†ØªÙØ§Ø¹ÛŒ {
            background-color: #663300 !important;
            color: white !important;
            font-weight: bold;
        }
        .doreh-Ù…Ø¬Ø§Ø²ÛŒ {
            background-color: #ffffff !important;
            color: #000 !important;
            font-weight: bold;
        }
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§ÛŒ editable */
        input[type="text"], select {
            width: 100%;
            box-sizing: border-box;
            padding: 4px;
            font-size: 13px;
            border: 1px solid #ccc;
            border-radius: 3px;
            text-align: center;
        }
        input[type="text"]:focus, select:focus {
            border-color: #007bff;
            outline: none;
            background: #eef6ff;
        }
        .field-period {
            max-width: 100px;
        }
        .actions-column {
            width: 80px;
        }
        .semester-cell {
            background-color: white;
        }
        .semester-cell:focus {
            background-color: #eef6ff;
        }
        .logo-container {
            text-align: center;
            margin: 15px 0;
        }
        .logo-placeholder {
            display: inline-block;
            width: 100px;
            height: 60px;
            background-color: #f0f0f0;
            border: 1px dashed #ccc;
            line-height: 60px;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ù‡Ø¯Ø± Ù…Ø®ØµÙˆØµ Ù¾Ø±ÛŒÙ†Øª -->
        <div class="print-header">
            <h1>ÙØ±Ù… Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø´ØªÙ‡ Ù‡ÙˆØ´Ù…Ù†Ø¯</h1>
            <h2>Ø§Ø­Ø³Ø§Ù† Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´ Ù…Ø´Ø§ÙˆØ± ØªØ­ØµÛŒÙ„ÛŒ Ùˆ Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ Ø¨Ø§Ù„ÛŒÙ†ÛŒ</h2>
            <p>Ø±Ø²Ø±Ùˆ ÙˆÙ‚Øª Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù¾ÛŒØ§Ù…Ú© Ø¨Ù‡ 09131467038</p>
            <p>Ø¢Ø´Ù†Ø§ÛŒÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø§ Ù…Ø´Ø§ÙˆØ±: https://zil.ink/ehsan.afshar</p>
            <div class="logo-container">
                <div class="logo-placeholder">Ù„ÙˆÚ¯Ùˆ</div>
            </div>
        </div>

        <!-- Ù‡Ø¯Ø± Ø§ØµÙ„ÛŒ -->
        <div class="header">
            <h1>ÙØ±Ù… Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø´ØªÙ‡ Ù‡ÙˆØ´Ù…Ù†Ø¯</h1>
            <h2>Ø§Ø­Ø³Ø§Ù† Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´ Ù…Ø´Ø§ÙˆØ± ØªØ­ØµÛŒÙ„ÛŒ Ùˆ Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ Ø¨Ø§Ù„ÛŒÙ†ÛŒ</h2>
            <div class="contact-info">
                <p>Ø±Ø²Ø±Ùˆ ÙˆÙ‚Øª Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù¾ÛŒØ§Ù…Ú© Ø¨Ù‡ 09131467038</p>
                <p>Ø¢Ø´Ù†Ø§ÛŒÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø§ Ù…Ø´Ø§ÙˆØ±: <a href="https://zil.ink/ehsan.afshar" target="_blank">https://zil.ink/ehsan.afshar</a></p>
            </div>
        </div>

        <div class="instructions">
            <h4>Ø±Ø§Ù‡Ù†Ù…Ø§:</h4>
            <p>Ø¨Ø±Ø§ÛŒ Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ØŒ Ø±ÙˆÛŒ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø¯ÛŒÙ Ú©Ù„ÛŒÚ© Ú©Ø±Ø¯Ù‡ Ùˆ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯ Ùˆ Ø³Ù¾Ø³ Ø±Ø¯ÛŒÙ Ø±Ø§ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯ Ø¨Ú©Ø´ÛŒØ¯.</p>
            <p>Ø¯Ø± Ø³ØªÙˆÙ† "Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ" Ø§Ø² Ø­Ø±ÙˆÙ Ø§Ø®ØªØµØ§Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯: Ø±=Ø±ÙˆØ²Ø§Ù†Ù‡, Ù†/Ø´=Ù†ÙˆØ¨Øª Ø¯ÙˆÙ…, Ù¾/Ù¾Ø±=Ù¾Ø±Ø¯ÛŒØ³, Ø§=Ø¢Ø²Ø§Ø¯, Ù¾ÛŒ=Ù¾ÛŒØ§Ù… Ù†ÙˆØ±, Øº=ØºÛŒØ±Ø§Ù†ØªÙØ§Ø¹ÛŒ, Ù…=Ù…Ø¬Ø§Ø²ÛŒ</p>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡ Ù‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª -->
        <div class="buttons">
            <button id="addRowBtn" class="btn btn-success">â• Ø§ÙØ²ÙˆØ¯Ù† Ø±Ø¯ÛŒÙ</button>
            <button id="exportBtn" class="btn btn-info">ğŸ“¥ Ø®Ø±ÙˆØ¬ÛŒ Ø§Ú©Ø³Ù„</button>
            <button id="importBtn" class="btn btn-secondary">ğŸ“¤ ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø² Ø§Ú©Ø³Ù„</button>
            <button id="printBtn" class="btn">ğŸ–¨ Ù¾Ø±ÛŒÙ†Øª</button>
            <input type="file" id="fileInput" style="display: none;" accept=".xlsx, .xls">
        </div>

        <div class="table-container print-section">
            <table id="mainTable">
                <thead>
                    <tr>
                        <th class="row-number">Ø±Ø¯ÛŒÙ</th>
                        <th>Ù†Ø§Ù… Ø±Ø´ØªÙ‡</th>
                        <th>Ø´Ù‡Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡</th>
                        <th>Ù†ÛŒÙ…Ø³Ø§Ù„</th>
                        <th>Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡</th>
                        <th>Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ</th>
                        <th>Ú©Ø¯ Ø±Ø´ØªÙ‡ Ù…Ø­Ù„</th>
                        <th class="actions-column">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙ</th>
                        <th class="actions-column">Ø­Ø°Ù Ø±Ø¯ÛŒÙ</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Ø±Ø¯ÛŒÙ Ù‡Ø§ ØªÙˆØ³Ø· Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Initialize jsPDF
        window.jsPDF = window.jspdf.jsPDF;

        $(document).ready(function() {
            const dorehMap = {
                'Ø±': {text: 'Ø±ÙˆØ²Ø§Ù†Ù‡', className: 'doreh-Ø±ÙˆØ²Ø§Ù†Ù‡'},
                'Ù†': {text: 'Ù†ÙˆØ¨Øª Ø¯ÙˆÙ…', className: 'doreh-Ù†ÙˆØ¨Øª-Ø¯ÙˆÙ…'},
                'Ø´': {text: 'Ù†ÙˆØ¨Øª Ø¯ÙˆÙ…', className: 'doreh-Ù†ÙˆØ¨Øª-Ø¯ÙˆÙ…'},
                'Ù¾Ø±': {text: 'Ù¾Ø±Ø¯ÛŒØ³ Ø³Ø±Ø§Ø³Ø±ÛŒ', className: 'doreh-Ù¾Ø±Ø¯ÛŒØ³-Ø³Ø±Ø§Ø³Ø±ÛŒ'},
                'Ø§': {text: 'Ø¢Ø²Ø§Ø¯', className: 'doreh-Ø¢Ø²Ø§Ø¯'},
                'Ù¾ÛŒ': {text: 'Ù¾ÛŒØ§Ù… Ù†ÙˆØ±', className: 'doreh-Ù¾ÛŒØ§Ù…-Ù†ÙˆØ±'},
                'Øº': {text: 'ØºÛŒØ±Ø§Ù†ØªÙØ§Ø¹ÛŒ', className: 'doreh-ØºÛŒØ±Ø§Ù†ØªÙØ§Ø¹ÛŒ'},
                'Ù…': {text: 'Ù…Ø¬Ø§Ø²ÛŒ', className: 'doreh-Ù…Ø¬Ø§Ø²ÛŒ'}
            };

            // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ (11 Ø±Ø¯ÛŒÙ)
            function initializeTable() {
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† 11 Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„ÛŒÙ‡
                for (let i = 0; i < 10; i++) {
                    addNewRow();
                }
                
                // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø±Ú¯ Ùˆ Ø¯Ø±Ø§Ù¾
                enableDragAndDrop();
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ
                enableCourseTypeAutoComplete();
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù‡
                enableAutoSave();
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
                loadSavedData();
            }
            
            // Ø§ÙØ²ÙˆØ¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ø¯ÛŒØ¯
            function addNewRow() {
                const rowCount = $('#tableBody tr').length;
                const rowNumber = rowCount + 1;
                
                const newRow = $(`
                    <tr class="resizable-row">
                        <td class="row-number">${rowNumber}</td>
                        <td><input type="text" class="field-major form-control" placeholder="Ù†Ø§Ù… Ø±Ø´ØªÙ‡" autocomplete="off" /></td>
                        <td><input type="text" class="field-city form-control" placeholder="Ø´Ù‡Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡" autocomplete="off" /></td>
                        <td>
                            <select class="field-semester form-control semester-cell">
                                <option value="" selected>---</option>
                                <option value="Ø§ÙˆÙ„">Ø§ÙˆÙ„</option>
                                <option value="Ø¯ÙˆÙ…">Ø¯ÙˆÙ…</option>
                            </select>
                        </td>
                        <td><input type="text" class="field-university form-control" placeholder="Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡" autocomplete="off" /></td>
                        <td><input type="text" class="field-period form-control" maxlength="2" autocomplete="off" placeholder="Ø±ØŒ Ù†ØŒ Ù¾ØŒ Ø§ØŒ Ù¾ÛŒØŒ ØºØŒ Ù…" /></td>
                        <td><input type="text" class="field-code form-control" placeholder="Ú©Ø¯ Ø±Ø´ØªÙ‡ Ù…Ø­Ù„" autocomplete="off" /></td>
                        <td class="actions-column"><button class="btn btn-sm btn-warning clear-row">ğŸ§¹</button></td>
                        <td class="actions-column"><button class="btn btn-sm btn-danger remove-row">ğŸ—‘ï¸</button></td>
                    </tr>
                `);
                
                $('#tableBody').append(newRow);
                
                // Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§
                updateRowNumbers();
                
                return newRow;
            }
            
            // Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§
            function updateRowNumbers() {
                $('#tableBody tr').each(function(index) {
                    $(this).find('.row-number').text(index + 1);
                });
            }
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø±Ú¯ Ùˆ Ø¯Ø±Ø§Ù¾ Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§
            function enableDragAndDrop() {
                $('#tableBody').sortable({
                    items: "tr",
                    cursor: "move",
                    opacity: 0.7,
                    start: function(event, ui) {
                        ui.item.addClass('dragging');
                    },
                    stop: function(event, ui) {
                        ui.item.removeClass('dragging');
                        // Ø´Ù…Ø§Ø±Ù‡ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ ØªØºÛŒÛŒØ± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯
                        updateRowNumbers();
                        autoSave();
                    },
                    placeholder: "ui-state-highlight",
                    forcePlaceholderSize: true
                }).disableSelection();
            }
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† ØªÚ©Ù…ÛŒÙ„ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ù†ÙˆØ¹ Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ
            function enableCourseTypeAutoComplete() {
                $(document).on('input', '.field-period', function() {
                    const value = $(this).val().trim();
                    const cell = $(this).parent();
                    
                    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ù„Ø§Ø³ Ù‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
                    cell.removeClass('doreh-Ø±ÙˆØ²Ø§Ù†Ù‡ doreh-Ù†ÙˆØ¨Øª-Ø¯ÙˆÙ… doreh-Ù¾Ø±Ø¯ÛŒØ³-Ø³Ø±Ø§Ø³Ø±ÛŒ doreh-Ø¢Ø²Ø§Ø¯ doreh-Ù¾ÛŒØ§Ù…-Ù†ÙˆØ± doreh-ØºÛŒØ±Ø§Ù†ØªÙØ§Ø¹ÛŒ doreh-Ù…Ø¬Ø§Ø²ÛŒ');
                    
                    if (value in dorehMap) {
                        $(this).val(dorehMap[value].text);
                        cell.addClass(dorehMap[value].className);
                    } else {
                        // Ø§Ú¯Ø± Ù…ØªÙ† ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ú©Ø§Ù…Ù„ Ø§Ø³Øª
                        let found = false;
                        $.each(dorehMap, function(key, item) {
                            if (item.text === value) {
                                cell.addClass(item.className);
                                found = true;
                                return false;
                            }
                        });
                        
                        // Ø§Ú¯Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ØŒ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†
                        if (!found && value === '') {
                            cell.removeClass('doreh-Ø±ÙˆØ²Ø§Ù†Ù‡ doreh-Ù†ÙˆØ¨Øª-Ø¯ÙˆÙ… doreh-Ù¾Ø±Ø¯ÛŒØ³-Ø³Ø±Ø§Ø³Ø±ÛŒ doreh-Ø¢Ø²Ø§Ø¯ doreh-Ù¾ÛŒØ§Ù…-Ù†ÙˆØ± doreh-ØºÛŒØ±Ø§Ù†ØªÙØ§Ø¹ÛŒ doreh-Ù…Ø¬Ø§Ø²ÛŒ');
                        }
                    }
                    
                    // Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø±
                    autoSave();
                });

                // Ø§Ù…Ú©Ø§Ù† Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Delete
                $(document).on('keydown', '.field-period', function(e) {
                    if (e.key === 'Delete' || e.key === 'Backspace') {
                        const value = $(this).val();
                        // Ø§Ú¯Ø± ÙÙ‚Ø· Û± ÛŒØ§ Û² Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ØŒ Ú©Ù„ Ù…Ø­ØªÙˆØ§ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†
                        if (value.length <= 4) {
                            $(this).val('');
                            $(this).parent().removeClass('doreh-Ø±ÙˆØ²Ø§Ù†Ù‡ doreh-Ù†ÙˆØ¨Øª-Ø¯ÙˆÙ… doreh-Ù¾Ø±Ø¯ÛŒØ³-Ø³Ø±Ø§Ø³Ø±ÛŒ doreh-Ø¢Ø²Ø§Ø¯ doreh-Ù¾ÛŒØ§Ù…-Ù†ÙˆØ± doreh-ØºÛŒØ±Ø§Ù†ØªÙØ§Ø¹ÛŒ doreh-Ù…Ø¬Ø§Ø²ÛŒ');
                            autoSave();
                        }
                    }
                });
            }
            
            // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø±
            function enableAutoSave() {
                $(document).on('input change', 'input, select', function() {
                    // ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯
                    clearTimeout(window.autoSaveTimeout);
                    window.autoSaveTimeout = setTimeout(autoSave, 500);
                });
            }
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ Ø±Ø¯ÛŒÙ
            $(document).on('click', '.clear-row', function() {
                const row = $(this).closest('tr');
                row.find('input[type="text"]').val('');
                row.find('.field-semester').val('');
                row.find('.field-period').parent().removeClass('doreh-Ø±ÙˆØ²Ø§Ù†Ù‡ doreh-Ù†ÙˆØ¨Øª-Ø¯ÙˆÙ… doreh-Ù¾Ø±Ø¯ÛŒØ³-Ø³Ø±Ø§Ø³Ø±ÛŒ doreh-Ø¢Ø²Ø§Ø¯ doreh-Ù¾ÛŒØ§Ù…-Ù†ÙˆØ± doreh-ØºÛŒØ±Ø§Ù†ØªÙØ§Ø¹ÛŒ doreh-Ù…Ø¬Ø§Ø²ÛŒ');
                autoSave();
            });
            
            // Ø­Ø°Ù Ø±Ø¯ÛŒÙ
            $(document).on('click', '.remove-row', function() {
                if ($('#tableBody tr').length > 1) {
                    $(this).closest('tr').remove();
                    updateRowNumbers();
                    autoSave();
                } else {
                    alert("Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø±Ø¯ÛŒÙ Ø¨Ø§ÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.");
                }
            });
            
            // Ø§ÙØ²ÙˆØ¯Ù† Ø±Ø¯ÛŒÙ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ø¯Ú©Ù…Ù‡
            $('#addRowBtn').on('click', function() {
                addNewRow();
                autoSave();
            });
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            function autoSave() {
                let data = getAllData();
                localStorage.setItem('formData', JSON.stringify(data));
            }
            
            // Ø¯Ø±ÛŒØ§ÙØª ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
            function getAllData() {
                let data = [];
                
                $('#tableBody tr').each(function() {
                    let rowData = [];
                    
                    // Ù†Ø§Ù… Ø±Ø´ØªÙ‡
                    rowData.push($(this).find('.field-major').val() || '');
                    
                    // Ø´Ù‡Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡
                    rowData.push($(this).find('.field-city').val() || '');
                    
                    // Ù†ÛŒÙ…Ø³Ø§Ù„
                    rowData.push($(this).find('.field-semester').val() || '');
                    
                    // Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡
                    rowData.push($(this).find('.field-university').val() || '');
                    
                    // Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ
                    rowData.push($(this).find('.field-period').val() || '');
                    
                    // Ú©Ø¯ Ø±Ø´ØªÙ‡ Ù…Ø­Ù„
                    rowData.push($(this).find('.field-code').val() || '');
                    
                    data.push(rowData);
                });
                
                return data;
            }
            
            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
            function loadSavedData() {
                const savedData = localStorage.getItem('formData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    // Ø­Ø°Ù Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
                    $('#tableBody').empty();
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡
                    data.forEach((rowData, index) => {
                        const newRow = addNewRow();
                        
                        // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                        newRow.find('.field-major').val(rowData[0] || '');
                        newRow.find('.field-city').val(rowData[1] || '');
                        newRow.find('.field-semester').val(rowData[2] || '');
                        newRow.find('.field-university').val(rowData[3] || '');
                        
                        // Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ
                        const periodValue = rowData[4] || '';
                        newRow.find('.field-period').val(periodValue);
                        
                        // Ú©Ø¯ Ø±Ø´ØªÙ‡ Ù…Ø­Ù„
                        newRow.find('.field-code').val(rowData[5] || '');
                        
                        // Ø§Ø¹Ù…Ø§Ù„ Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ
                        if (periodValue) {
                            let found = false;
                            $.each(dorehMap, function(key, item) {
                                if (item.text === periodValue) {
                                    newRow.find('.field-period').parent().addClass(item.className);
                                    found = true;
                                    return false;
                                }
                            });
                            
                            // Ø§Ú¯Ø± Ù…Ù‚Ø¯Ø§Ø± Ú©ÙˆØªØ§Ù‡ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡
                            if (!found) {
                                for (const [key, value] of Object.entries(dorehMap)) {
                                    if (periodValue.includes(key)) {
                                        newRow.find('.field-period').val(value.text);
                                        newRow.find('.field-period').parent().addClass(value.className);
                                        found = true;
                                        break;
                                    }
                                }
                            }
                        }
                    });
                    
                    // Ø¨Ù‡ Ø±ÙˆØ² Ø±Ø³Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§
                    updateRowNumbers();
                }
            }
            
            // Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ù‡ Ø§Ú©Ø³Ù„
            $('#exportBtn').on('click', function() {
                // Ø§ÛŒØ¬Ø§Ø¯ workbook Ùˆ worksheet
                const wb = XLSX.utils.book_new();
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ú©Ø³Ù„
                const excelData = [];
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‡Ø¯Ø± Ø¨Ø±Ø§ÛŒ Ø§Ú©Ø³Ù„ (5 Ø³Ø·Ø±)
                excelData.push(['ÙØ±Ù… Ù¾ÛŒØ´â€ŒÙ†ÙˆÛŒØ³ Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø´ØªÙ‡ Ù‡ÙˆØ´Ù…Ù†Ø¯']);
                excelData.push(['Ø§Ø­Ø³Ø§Ù† Ø§ÙØ´Ø§Ø±Ù…Ù†Ø´ Ù…Ø´Ø§ÙˆØ± ØªØ­ØµÛŒÙ„ÛŒ Ùˆ Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ Ø¨Ø§Ù„ÛŒÙ†ÛŒ']);
                excelData.push(['Ø±Ø²Ø±Ùˆ ÙˆÙ‚Øª Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù¾ÛŒØ§Ù…Ú© Ø¨Ù‡ 09131467038']);
                excelData.push(['Ø¢Ø´Ù†Ø§ÛŒÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø§ Ù…Ø´Ø§ÙˆØ±: https://zil.ink/ehsan.afshar']);
                excelData.push([]);
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù†ÙˆØ§Ù† Ø³ØªÙˆÙ†â€ŒÙ‡Ø§
                const headers = ['Ø±Ø¯ÛŒÙ', 'Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ', 'Ú©Ø¯ Ø±Ø´ØªÙ‡ Ù…Ø­Ù„', 'Ù†Ø§Ù… Ø±Ø´ØªÙ‡', 'Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', 'Ø´Ù‡Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡', 'Ù†ÛŒÙ…Ø³Ø§Ù„'];
                excelData.push(headers);
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§
                $('#tableBody tr').each(function(index) {
                    // ÙÙ‚Ø· Ø§Ú¯Ø± Ù†Ø§Ù… Ø±Ø´ØªÙ‡ Ù¾Ø± Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
                    const majorValue = $(this).find('.field-major').val() || '';
                    if (majorValue.trim() !== '') {
                        let rowData = [];
                        
                        // Ø´Ù…Ø§Ø±Ù‡ Ø±Ø¯ÛŒÙ
                        rowData.push(index + 1);
                        
                        // Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ
                        rowData.push($(this).find('.field-period').val() || '');
                        
                        // Ú©Ø¯ Ø±Ø´ØªÙ‡ Ù…Ø­Ù„
                        rowData.push($(this).find('.field-code').val() || '');
                        
                        // Ù†Ø§Ù… Ø±Ø´ØªÙ‡
                        rowData.push(majorValue);
                        
                        // Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡
                        rowData.push($(this).find('.field-university').val() || '');
                        
                        // Ø´Ù‡Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡
                        rowData.push($(this).find('.field-city').val() || '');
                        
                        // Ù†ÛŒÙ…Ø³Ø§Ù„
                        rowData.push($(this).find('.field-semester').val() || '');
                        
                        excelData.push(rowData);
                    }
                });
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ ØªØ§ 150 Ø±Ø¯ÛŒÙ
                const currentRows = excelData.length - 6; // 6 Ø³Ø·Ø± Ø¨Ø±Ø§ÛŒ Ù‡Ø¯Ø± Ùˆ Ø¹Ù†ÙˆØ§Ù†
                for (let i = currentRows; i < 150; i++) {
                    excelData.push([i + 1, '', '', '', '', '', '']);
                }
                
                const ws = XLSX.utils.aoa_to_sheet(excelData);
                
                // Ø§Ø¯ØºØ§Ù… Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ø¯Ø±
                ws['!merges'] = [
                    {s: {r: 0, c: 0}, e: {r: 0, c: 6}}, // Ø³Ø·Ø± Ø§ÙˆÙ„
                    {s: {r: 1, c: 0}, e: {r: 1, c: 6}}, // Ø³Ø·Ø± Ø¯ÙˆÙ…
                    {s: {r: 2, c: 0}, e: {r: 2, c: 6}}, // Ø³Ø·Ø± Ø³ÙˆÙ…
                    {s: {r: 3, c: 0}, e: {r: 3, c: 6}}  // Ø³Ø·Ø± Ú†Ù‡Ø§Ø±Ù…
                ];
                
                // ØªÙ†Ø¸ÛŒÙ… Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø§Ú©Ø³Ù„
                const range = XLSX.utils.decode_range(ws['!ref']);
                for (let R = range.s.r; R <= range.e.r; ++R) {
                    for (let C = range.s.c; C <= range.e.c; ++C) {
                        const cell_address = {c: C, r: R};
                        const cell_ref = XLSX.utils.encode_cell(cell_address);
                        
                        if (!ws[cell_ref]) continue;
                        
                        // ØªÙ†Ø¸ÛŒÙ… Ù…Ø±Ø²Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§
                        ws[cell_ref].s = {
                            border: {
                                top: {style: "thin", color: {rgb: "000000"}},
                                bottom: {style: "thin", color: {rgb: "000000"}},
                                left: {style: "thin", color: {rgb: "000000"}},
                                right: {style: "thin", color: {rgb: "000000"}}
                            },
                            alignment: {
                                horizontal: "center",
                                vertical: "center"
                            }
                        };
                        
                        // Ø¹Ù†ÙˆØ§Ù†â€ŒÙ‡Ø§ (Ø³Ø·Ø± 5)
                        if (R === 5) {
                            ws[cell_ref].s.fill = {fgColor: {rgb: "3F51B5"}};
                            ws[cell_ref].s.font = {bold: true, color: {rgb: "FFFFFF"}};
                        }
                        // Ù‡Ø¯Ø±Ù‡Ø§ (Ø³Ø·Ø± 0-3)
                        else if (R >= 0 && R <= 3) {
                            ws[cell_ref].s.font = {bold: true, size: R === 0 ? 16 : 12};
                            ws[cell_ref].s.alignment = {horizontal: "center", vertical: "center"};
                        }
                        // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                        else if (R >= 6) {
                            // Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ø¯ÙˆØ±Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ­ØµÛŒÙ„ÛŒ
                            if (C === 1 && ws[cell_ref] && ws[cell_ref].v) {
                                const value = ws[cell_ref].v;
                                if (value.includes('Ø±ÙˆØ²Ø§Ù†Ù‡')) {
                                    ws[cell_ref].s.fill = {fgColor: {rgb: "000000"}};
                                    ws[cell_ref].s.font = {color: {rgb: "FFFFFF"}, bold: true};
                                } else if (value.includes('Ù†ÙˆØ¨Øª Ø¯ÙˆÙ…')) {
                                    ws[cell_ref].s.fill = {fgColor: {rgb: "009900"}};
                                    ws[cell_ref].s.font = {color: {rgb: "FFFFFF"}, bold: true};
                                } else if (value.includes('Ù¾Ø±Ø¯ÛŒØ³') || value.includes('Ø¢Ø²Ø§Ø¯')) {
                                    ws[cell_ref].s.fill = {fgColor: {rgb: "CC0000"}};
                                    ws[cell_ref].s.font = {color: {rgb: "FFFFFF"}, bold: true};
                                } else if (value.includes('Ù¾ÛŒØ§Ù… Ù†ÙˆØ±') || value.includes('ØºÛŒØ±Ø§Ù†ØªÙØ§Ø¹ÛŒ')) {
                                    ws[cell_ref].s.fill = {fgColor: {rgb: "663300"}};
                                    ws[cell_ref].s.font = {color: {rgb: "FFFFFF"}, bold: true};
                                } else if (value.includes('Ù…Ø¬Ø§Ø²ÛŒ')) {
                                    ws[cell_ref].s.fill = {fgColor: {rgb: "FFFFFF"}};
                                    ws[cell_ref].s.font = {color: {rgb: "000000"}, bold: true};
                                }
                            }
                            
                            // Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ Ù…ØªÙ†Ø§ÙˆØ¨ Ø¨Ø±Ø§ÛŒ Ø³Ø·Ø±Ù‡Ø§
                            if (R % 2 === 0) {
                                if (!ws[cell_ref].s.fill) {
                                    ws[cell_ref].s.fill = {fgColor: {rgb: "F0F0F0"}};
                                }
                            } else {
                                if (!ws[cell_ref].s.fill) {
                                    ws[cell_ref].s.fill = {fgColor: {rgb: "FFFFFF"}};
                                }
                            }
                        }
                    }
                }
                
                // ØªÙ†Ø¸ÛŒÙ… Ø¹Ø±Ø¶ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§
                ws['!cols'] = [
                    {wch: 6},  // Ø±Ø¯ÛŒÙ
                    {wch: 15}, // Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ
                    {wch: 12}, // Ú©Ø¯ Ø±Ø´ØªÙ‡ Ù…Ø­Ù„
                    {wch: 30}, // Ù†Ø§Ù… Ø±Ø´ØªÙ‡
                    {wch: 30}, // Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡
                    {wch: 15}, // Ø´Ù‡Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡
                    {wch: 10}  // Ù†ÛŒÙ…Ø³Ø§Ù„
                ];
                
                XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø´ØªÙ‡");
                
                // ØªÙˆÙ„ÛŒØ¯ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯
                XLSX.writeFile(wb, "Ø§Ù†ØªØ®Ø§Ø¨_Ø±Ø´ØªÙ‡.xlsx");
            });
            
            // ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø² Ø§Ú©Ø³Ù„
            $('#importBtn').on('click', function() {
                $('#fileInput').click();
            });
            
            $('#fileInput').on('change', function(e) {
                let file = e.target.files[0];
                if (!file) return;
                
                let reader = new FileReader();
                reader.onload = function(e) {
                    let data = new Uint8Array(e.target.result);
                    let workbook = XLSX.read(data, {type: 'array'});
                    
                    // Ø®ÙˆØ§Ù†Ø¯Ù† Ø§ÙˆÙ„ÛŒÙ† sheet
                    let worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    let excelData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    
                    // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø³Ø·Ø± Ø´Ø±ÙˆØ¹ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ (Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø¯Ø±)
                    let startRow = 0;
                    for (let i = 0; i < excelData.length; i++) {
                        if (excelData[i] && excelData[i][0] === 'Ø±Ø¯ÛŒÙ') {
                            startRow = i + 1;
                            break;
                        }
                    }
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    let importedData = [];
                    for (let i = startRow; i < excelData.length; i++) {
                        if (excelData[i].length > 1 && excelData[i][0] !== '') {
                            importedData.push([
                                excelData[i][3] || '', // Ù†Ø§Ù… Ø±Ø´ØªÙ‡
                                excelData[i][5] || '', // Ø´Ù‡Ø± Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡
                                excelData[i][6] || 'Ø§ÙˆÙ„', // Ù†ÛŒÙ…Ø³Ø§Ù„
                                excelData[i][4] || '', // Ù†Ø§Ù… Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡
                                excelData[i][1] || '', // Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ
                                excelData[i][2] || ''  // Ú©Ø¯ Ø±Ø´ØªÙ‡ Ù…Ø­Ù„
                            ]);
                        }
                    }
                    
                    // Ø­Ø°Ù Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
                    $('#tableBody').empty();
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ú©Ø³Ù„
                    importedData.forEach((rowData, index) => {
                        const newRow = addNewRow();
                        
                        // Ù¾Ø± Ú©Ø±Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                        newRow.find('.field-major').val(rowData[0] || '');
                        newRow.find('.field-city').val(rowData[1] || '');
                        newRow.find('.field-semester').val(rowData[2] || 'Ø§ÙˆÙ„');
                        newRow.find('.field-university').val(rowData[3] || '');
                        
                        // Ø¯ÙˆØ±Ù‡ ØªØ­ØµÛŒÙ„ÛŒ
                        const periodValue = rowData[4] || '';
                        newRow.find('.field-period').val(periodValue);
                        
                        // Ú©Ø¯ Ø±Ø´ØªÙ‡ Ù…Ø­Ù„
                        newRow.find('.field-code').val(rowData[5] || '');
                        
                        // Ø§Ø¹Ù…Ø§Ù„ Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ
                        if (periodValue) {
                            let found = false;
                            $.each(dorehMap, function(key, item) {
                                if (item.text === periodValue) {
                                    newRow.find('.field-period').parent().addClass(item.className);
                                    found = true;
                                    return false;
                                }
                            });
                            
                            // Ø§Ú¯Ø± Ù…Ù‚Ø¯Ø§Ø± Ú©ÙˆØªØ§Ù‡ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡
                            if (!found) {
                                for (const [key, value] of Object.entries(dorehMap)) {
                                    if (periodValue.includes(key)) {
                                        newRow.find('.field-period').val(value.text);
                                        newRow.find('.field-period').parent().addClass(value.className);
                                        found = true;
                                        break;
                                    }
                                }
                            }
                        }
                    });
                    
                    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    autoSave();
                    
                    // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† input ÙØ§ÛŒÙ„
                    $('#fileInput').val('');
                };
                reader.readAsArrayBuffer(file);
            });
            
            // Ù¾Ø±ÛŒÙ†Øª
            $('#printBtn').on('click', function() {
                window.print();
            });
            
            // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
            initializeTable();
        });
    </script>
</body>
</html>